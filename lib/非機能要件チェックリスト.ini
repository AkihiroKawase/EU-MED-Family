````
# EMCA v1 非機能要件チェックリスト
## Notes
- 対象: iOS（iPhone縦のみ／iPad縦横）、iOS 18以上。バックエンドは Cloud Functions＋Notion API＋Firestore/FCM/Storage。
- キャッシュ: 一覧60秒／詳細300秒。保存/削除時に該当＋一覧をパージ。
- 閲覧はログイン必須。UGC（通報なし・管理者の削除/非表示あり）。

# Tasks
- [ ] 1.0 パフォーマンス/SLO（体感とAPIの目標）
  - [ ] 1.1 一覧API TTFB（キャッシュHIT時）: p50 ≤ 300ms / p95 ≤ 600ms（MISS時 p95 ≤ 1500ms）
  - [ ] 1.2 詳細API TTFB（HIT）: p50 ≤ 300ms / p95 ≤ 600ms（MISS時 p95 ≤ 1500ms）
  - [ ] 1.3 コメント親一覧API: p95 ≤ 600ms、返信取得API: p95 ≤ 600ms
  - [ ] 1.4 アプリ体感（Wi‑Fi）: 一覧初回描画 ≤ 1.2s、詳細WebView初回コンテンツ表示 ≤ 2.5s
  - [ ] 1.5 アプリ体感（4G）: 一覧 ≤ 2.0s、詳細WebView ≤ 3.5s
  - [ ] 1.6 Cloud Functions コールドスタート: p95 ≤ 1.5s、ウォーム: p95 ≤ 300ms
  - [ ] 1.7 アプリDLサイズ目標: ≤ 100MB（不要アセット削減）

- [ ] 2.0 可用性/信頼性
  - [ ] 2.1 目標可用性: 99.5%（Notion依存のためカバレッジは通知）
  - [ ] 2.2 フェイルセーフ: Notion障害時は最後の有効キャッシュを表示、エラーバナー提示
  - [ ] 2.3 リトライ/バックオフ: Notion 429/5xxに指数バックオフ（最大3回）

- [ ] 3.0 スケーラビリティ/キャッシュ/レート
  - [ ] 3.1 キャッシュキー設計（一覧: page/filters、詳細: postId）を確定
  - [ ] 3.2 同一クエリの瞬間的多重MISS抑制（簡易ロック/デデュープ方針）
  - [ ] 3.3 想定同時利用: 同時RPS目安と上限（例: 50RPS）を設定、超過時の挙動定義

- [ ] 4.0 セキュリティ/権限
  - [ ] 4.1 Firestore ルール: 認証必須、所有者のみコメント削除、管理者ロールで非表示/削除
  - [ ] 4.2 Storage ルール: 認証ユーザーのアップロードのみ、公開URL発行方針
  - [ ] 4.3 Functions: 管理APIは認証＋管理者Claims必須、Notionキーは環境変数で保護
  - [ ] 4.4 FCM/APNs鍵管理: アクセス権とローテーション方針

- [ ] 5.0 プライバシー/データ保護
  - [ ] 5.1 収集データ台帳（ユーザーID/通知トークン/投稿・コメント等）作成
  - [ ] 5.2 保存期間/削除方針（ユーザー退会時のデータ取り扱い）文書化
  - [ ] 5.3 PII/ログのマスキング方針（メール/名前をログに残さない）

- [ ] 6.0 ログ/監視/アラート
  - [ ] 6.1 Functions 構造化ログ（リクエストID/ユーザーID匿名化/レイテンシ/キャッシュHIT）
  - [ ] 6.2 主要SLOダッシュボード（一覧/詳細/コメントAPIのp50/p95、エラー率）
  - [ ] 6.3 アラート閾値: エラー率>2%（5分平均）、p95レイテンシ2倍超で通知

- [ ] 7.0 運用/バックアップ
  - [ ] 7.1 Firestore エクスポート（日次）→ GCS 保管（保持30日）
  - [ ] 7.2 Notion データの週次エクスポート運用（管理者作業）
  - [ ] 7.3 障害時手順（キャッシュ延長/一時的機能制限）のRunbook

- [ ] 8.0 リリース/構成管理
  - [ ] 8.1 ステージング/本番の分離（Firebase/Notion/通知）を確認
  - [ ] 8.2 バージョニング規約（semver）とタグ付け運用
  - [ ] 8.3 機能フラグの有無（v1は原則なし、必要時のみ最低限）

- [ ] 9.0 アクセシビリティ/UX
  - [ ] 9.1 Dynamic Type対応（主要画面で文字拡大時の崩れ無し）
  - [ ] 9.2 VoiceOver読み上げ（一覧カード/ボタン/コメント）
  - [ ] 9.3 タップ領域44pt以上、コントラスト比準拠

- [ ] 10.0 ローカライズ/タイムゾーン
  - [ ] 10.1 表示は端末ローカルタイム（UTC保存から変換）統一
  - [ ] 10.2 言語方針（v1=日本語のみ）表記揺れ・英数字半角統一

- [ ] 11.0 モバイル固有要件
  - [ ] 11.1 WebView埋め込みCSP/X-Frame対策（Canva限定、不可時フォールバックUI）
  - [ ] 11.2 バッテリー/データ節約（不要ポーリング抑止、画像遅延読み込み）
  - [ ] 11.3 オフライン時の挙動（エラーメッセージと再試行）

- [ ] 12.0 コンプライアンス/ストア
  - [ ] 12.1 UGCポリシー（利用規約/プライポリURL）整備
  - [ ] 12.2 App Privacy回答整合（収集項目/用途/リンクの有無）
  - [ ] 12.3 医療関連表現の審査リスク確認（説明ノート準備）

- [ ] 13.0 サポート/SLA
  - [ ] 13.1 管理者削除/非表示の対応SLA（例: 48h以内）を明記
  - [ ] 13.2 問い合わせ導線（アプリ内/ストアのサポートURL）

- [ ] 14.0 コスト/クォータ管理
  - [ ] 14.1 Firestore/Functionsの日次コスト監視（しきい値通知）
  - [ ] 14.2 Notion APIレート監視（429検出数/日）
  - [ ] 14.3 画像Storageのサイズ/転送量しきい値

- [ ] 15.0 受け入れ条件（NFR完了判定）
  - [ ] 15.1 SLO準拠（p95レイテンシ・体感基準クリア）
  - [ ] 15.2 可用性・キャッシュ・リトライの実動確認
  - [ ] 15.3 セキュリティルール/秘密情報管理の確認
  - [ ] 15.4 監視/アラート/バックアップの稼働確認
````