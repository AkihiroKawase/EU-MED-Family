````
# EMCA 掲示板 v1 受け入れ基準チェックリスト
## Notes
- 投稿データ: Notion保存。コメント/いいね/ブックマーク/通知/集計はFirebase（Firestore/FCM）。カバー画像はFirebase Storage。
- 詳細画面: WebViewでCanvaスマート埋め込みURLを表示。ネイティブUIで「いいね/ブックマーク/コメント」。コメントはボトムシート表示。
- 並び順: 公開日時の新しい順（未来日時も表示）。一覧はページ番号式（1ページ20件）。
- 検索/絞り込み: キーワード（メタのみ）＋カテゴリ＋タグ（OR）をANDで適用。
- 通知: コメント（自分の投稿）/返信（自分のコメント）/いいね。全体オン/オフのみ（既定ON）。
- 削除: 投稿・コメントはソフト削除方針。運営は投稿（Notion）/コメント（アプリUI）で管理可。
- キャッシュ: 一覧60秒、詳細300秒。保存/削除時は該当＋一覧をパージ。
- 時刻: 保存UTC、表示は端末ローカル。

# Tasks
- [ ] 1.0 認証・アクセス
  - [ ] 1.1 未ログイン時は掲示板一覧・詳細へのアクセスが遮断され、ログイン導線が表示される
  - [ ] 1.2 ログイン後は一覧/詳細/コメント/いいね/ブックマーク操作が可能になる

- [ ] 2.0 投稿作成（入力検証）
  - [ ] 2.1 タイトルは必須・最大60文字でバリデートされる
  - [ ] 2.2 Canvaスマート埋め込みURLのみ受理し、その他のURLはエラーとなる
  - [ ] 2.3 カテゴリは任意で選択できる（未選択でも投稿可能）
  - [ ] 2.4 タグは1〜5件の選択でバリデートされる（超過・0件はエラー）
  - [ ] 2.5 サマリー入力時は最大160文字でバリデートされる
  - [ ] 2.6 送信時に`published_at`がサーバー側でUTC現在時刻に自動設定される
  - [ ] 2.7 カバー画像は任意でアップロード可能（PNG/JPG、≤5MB、16:9以外は中央トリミング）

- [ ] 3.0 投稿保存（Notion）
  - [ ] 3.1 Notionにタイトル/サマリー/カテゴリ/タグ（リレーション）/published_at/authorUserId/authorName/外部リンクURL/カバー画像URL（任意）が保存される
  - [ ] 3.2 保存後、一覧・詳細キャッシュがパージされ、即時または60秒以内に反映される

- [ ] 4.0 一覧表示
  - [ ] 4.1 公開日時の新しい順で並ぶ（published_at desc）
  - [ ] 4.2 未来日時の投稿も表示される
  - [ ] 4.3 ページ番号式で1ページ20件が表示される（次/前ページ遷移が正しく動作）
  - [ ] 4.4 各カードにタイトル/（任意）カバー画像/いいね数が表示される
  - [ ] 4.5 いいね/ブックマークのトグルが一覧から操作でき、即座にUI反映される
  - [ ] 4.6 キーワード検索はタイトル/サマリー/カテゴリ名/タグ名のみを対象に一致する
  - [ ] 4.7 カテゴリ絞り込みは一致する投稿のみ表示される
  - [ ] 4.8 タグ絞り込みはOR条件で一致した投稿が表示される
  - [ ] 4.9 キーワード＋カテゴリ＋タグはANDで同時適用される

- [ ] 5.0 詳細画面（WebView＋ネイティブ操作）
  - [ ] 5.1 WebViewにCanvaスマート埋め込みが表示される
  - [ ] 5.2 埋め込みがブロックされる場合、警告と「外部ブラウザで開く」ボタンが表示される（本文はWebViewで表示しない）
  - [ ] 5.3 いいね/ブックマーク/コメントボタンがWebView周辺に表示される
  - [ ] 5.4 通知をタップすると詳細WebViewが開く（コメントパネルは自動展開しない）

- [ ] 6.0 コメント（UI/取得）
  - [ ] 6.1 コメントパネルはボトムシートで開閉できる
  - [ ] 6.2 親コメントは古い順で20件/ページ表示される（ページ遷移が正しく動作）
  - [ ] 6.3 各親コメントの返信は折りたたみで、展開時に追加読み込みされる
  - [ ] 6.4 スレッドは無制限ネストで表示・投稿できる
  - [ ] 6.5 コメントはテキストのみ、最大1000文字、改行可でバリデートされる
  - [ ] 6.6 コメントの著者名/アイコンはFirebaseの最新プロフィールが表示される

- [ ] 7.0 コメント（作成/削除/管理）
  - [ ] 7.1 投稿者は自分のコメントを削除できる（編集不可）
  - [ ] 7.2 ソフト削除されたコメントは本文が「[削除済み]」と表示され、子コメントは残る
  - [ ] 7.3 管理者はコメントを非表示/ソフト削除できる（通常ユーザーには見えない）
  - [ ] 7.4 非表示・削除操作後、一覧・詳細の表示に即時反映される

- [ ] 8.0 いいね/ブックマーク
  - [ ] 8.1 いいね/ブックマークは投稿のみを対象とする（コメントには付与不可）
  - [ ] 8.2 いいねはトグル可能で、同一ユーザーの多重いいねが防止される
  - [ ] 8.3 いいねトグル時に`postStats.likesCount`が即時増減する
  - [ ] 8.4 一覧に表示されるいいね数は`postStats`と一致する
  - [ ] 8.5 ブックマークはトグル可能で、マイページのブックマーク一覧（v1対象外なら非表示）が整合する

- [ ] 9.0 通知
  - [ ] 9.1 自分の投稿に新規コメントで通知が届く（受信を確認）
  - [ ] 9.2 自分のコメントへの返信で通知が届く（受信を確認）
  - [ ] 9.3 自分の投稿へのいいねで通知が届く（受信を確認）
  - [ ] 9.4 通知の全体オン/オフ設定が反映され、オフ時は通知が届かない
  - [ ] 9.5 通知タップで対象投稿の詳細WebViewが開く

- [ ] 10.0 著者情報
  - [ ] 10.1 Notionに`authorUserId`と`authorName`が保存される
  - [ ] 10.2 表示は常にFirebaseプロフィールの最新（名前・アイコン）が反映される
  - [ ] 10.3 プロフィール変更後、過去投稿の表示も最新プロフィールに更新される

- [ ] 11.0 画像（カバー）
  - [ ] 11.1 PNG/JPG以外の拡張子はアップロード時に拒否される
  - [ ] 11.2 5MB超の画像はアップロード時に拒否される
  - [ ] 11.3 16:9以外の画像は中央トリミングされて表示崩れがない
  - [ ] 11.4 アップロード後にStorageの公開URLがNotionに保存される

- [ ] 12.0 タグ・カテゴリ
  - [ ] 12.1 タグは別DB（リレーション）で管理され、選択UIに全候補が表示される
  - [ ] 12.2 タグのグループ（国・地域/試験関連/勉強法/生活関連/投稿の種類）で表示・絞り込みできる
  - [ ] 12.3 タグ複数選択時はOR条件で一覧が絞り込まれる
  - [ ] 12.4 カテゴリは単一選択で絞り込める

- [ ] 13.0 マイページ
  - [ ] 13.1 自分の投稿一覧が正しく表示される（並び・件数・ページング）
  - [ ] 13.2 通知履歴一覧が表示される（受け取った通知が時系列で確認できる）

- [ ] 14.0 キャッシュ/整合性
  - [ ] 14.1 一覧APIはTTL60秒、詳細APIはTTL300秒で応答する
  - [ ] 14.2 投稿の作成/削除時に該当詳細と一覧キャッシュが即時パージされる
  - [ ] 14.3 TTL期間内でもパージ後は最新状態が取得できる

- [ ] 15.0 時刻・並び
  - [ ] 15.1 `published_at`はUTC保存で、端末ローカルに変換して表示される
  - [ ] 15.2 並び順は`published_at`降順で安定している

- [ ] 16.0 セキュリティ・連携
  - [ ] 16.1 アプリはNotion APIを直接呼ばず、Cloud Functions経由でのみ操作する
  - [ ] 16.2 Firestore/Storageの権限は認証ユーザーのみに適用される（閲覧/投稿要件を満たす）

- [ ] 17.0 失敗時ハンドリング
  - [ ] 17.1 埋め込み不可時にユーザーへ明確な警告と「外部ブラウザで開く」ボタンが表示される
  - [ ] 17.2 ネットワークエラー時はリトライ/案内が表示される
  - [ ] 17.3 権限エラー時はログイン/権限不足の明確な案内が表示される
````