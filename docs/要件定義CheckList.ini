```` 
# EMCA 掲示板（LINE NEWS風）v1 仕様計画
## Notes
- データ保管: 投稿本体はNotion。コメント/いいね/ブックマークはFirebase（Firestore）。カバー画像はFirebase Storage。
- 公開: 即時公開。並び順は公開日時の新しい順（ピン留め未使用）。未来日時も即時表示。
- 投稿: 全ログインユーザー投稿可。外部リンクURLはCanvaのスマート埋め込みURLのみ許可（他はエラー）。
- 詳細画面: WebViewでCanva埋め込みを表示。ネイティブUIで「いいね」「ブックマーク」「コメント」ボタン。コメントはボトムシート（下部スライド）。
- コメント: 無制限ネスト。並びは古い順。親20件/ページのページネーション、返信は親ごとに折りたたみ読み込み。テキストのみ（1000文字、改行可）。編集不可・削除のみ（ソフト削除）。
- いいね/ブックマーク: 投稿のみ対象。トグル可。集計はFirestoreの集計ドキュメントで増減。一覧で「いいね数」のみ表示。
- 検索/絞り込み: メタデータのみ対象（タイトル/サマリー/タグ名/カテゴリ名）。カテゴリ1つ、タグはOR条件。キーワード/カテゴリ/タグはANDで組み合わせ。
- 一覧: ログイン必須。ページ番号式。1ページ20件。
- 通知: コメント（自分の投稿）/返信（自分のコメント）/いいね を送信。全体オン/オフのみ（デフォルトON）。通知タップで詳細WebViewのみを開く（コメントパネルは手動）。
- 著者情報: NotionにauthorUserId＋著者名を保存（表示はFirebaseプロフィール優先）。最新プロフィール反映。
- 画像ルール（カバー）: PNG/JPGのみ。最大5MB。16:9以外は中央トリミング。カバーは任意。
- タグ: 別DBで管理し投稿とリレーション。タグDBに「グループ」Selectを持つ。選択数は1〜5。
- タイムゾーン: 保存はUTC、表示は端末ローカル。
- 取得経路/キャッシュ: アプリ→Cloud Functions→Notion API。一覧TTL=60秒、詳細TTL=300秒。保存/削除時に該当ページ＋一覧をパージ。
- 権限/管理: 運営は投稿（Notion）/コメント（アプリ管理UI）をソフト削除/非表示可。
- 埋め込み不可時フォールバック: 警告＋「外部ブラウザで開く」ボタン（WebViewで本文は表示しない）。

# Tasks
- [ ] 1.0 Notion: 投稿DBを作成（名称・権限の確定）
  - [ ] 1.1 `Title`（必須, Title型）を作成
  - [ ] 1.2 `Summary`（任意, Rich text）を作成（最大160文字を運用ルールに明記）
  - [ ] 1.3 `External Link URL`（必須, URL）を作成（Canvaスマート埋め込みURLのみ許可の運用ルールを明記）
  - [ ] 1.4 `Published At`（必須, Date）を作成（保存時サーバー自動設定の運用ルールを明記）
  - [ ] 1.5 `Category`（任意, Select）を作成（初期候補を登録）
  - [ ] 1.6 `Author User ID`（必須, Text）を作成
  - [ ] 1.7 `Author Name`（必須, Text）を作成（表示はFirebase優先の注記）
  - [ ] 1.8 `Cover Image URL`（任意, URL or Files）を作成（Storageの公開URL保存を運用ルールに明記）
  - [ ] 1.9 `Language/Region`（任意, Select or Text）を作成
  - [ ] 1.10 `Pin`（任意, Checkbox or Number）を作成（v1では並び替えに未使用の注記）
  - [ ] 1.11 `Body`（任意, Rich text）を作成（v1表示では未使用の注記）
  - [ ] 1.12 `Tags`（必須, Relation to Tags DB）を作成（選択上限5の運用ルールを明記）

- [ ] 2.0 Notion: タグDBを作成
  - [ ] 2.1 `Name`（必須, Title）を作成
  - [ ] 2.2 `Group`（必須, Select）を作成（「国・地域／試験関連／勉強法／生活関連／投稿の種類」を登録）
  - [ ] 2.3 初期タグを全登録（提示リストに基づく全件）
  - [ ] 2.4 タグDBと投稿DBのリレーションを確認（多対多で選択上限5）

- [ ] 3.0 Firebase: Firestoreコレクション設計
  - [ ] 3.1 `comments`コレクションを用意（postId=NotionページID）
  - [ ] 3.2 `likes`コレクションを用意（postId＋userIdの一意制約を運用ルールに明記）
  - [ ] 3.3 `bookmarks`コレクションを用意（postId＋userId）
  - [ ] 3.4 `postStats`（集計）を用意（postIdごとにlikesCountを保持）
  - [ ] 3.5 コメントのスレッド表現方式を決定（親子参照の運用ルールを明記）
  - [ ] 3.6 ソフト削除フラグ/非表示フラグのフィールド方針を定義（投稿はNotion側、コメントはFirestore側）

- [ ] 4.0 Firebase: Storage設定（カバー画像）
  - [ ] 4.1 バケットのルール方針を定義（認証ユーザーのみアップロード可）
  - [ ] 4.2 画像検証ルールを運用に明記（PNG/JPG、最大5MB、16:9以外は中央トリミング）
  - [ ] 4.3 アップロード後の公開URL取得方針を定義（Notionに保存）

- [ ] 5.0 Firebase: 認証/権限
  - [ ] 5.1 掲示板閲覧をログイン必須に設定（ガード導線を定義）
  - [ ] 5.2 投稿/コメント/リアクションの認可要件を定義（ログイン必須）

- [ ] 6.0 Cloud Functions: Notion連携エンドポイント設計
  - [ ] 6.1 投稿作成APIを設計（入力検証：タイトル/URL/カテゴリ/タグ、URLはCanva埋め込みのみ許可）
  - [ ] 6.2 `Published At`を保存時にUTCで自動設定（サーバー時刻）
  - [ ] 6.3 投稿一覧取得APIを設計（ページ番号式・1ページ20件・新着順・検索/カテゴリ/タグフィルタ対応）
  - [ ] 6.4 投稿詳細取得APIを設計（メタデータ＋Canva埋め込みURL返却）
  - [ ] 6.5 キャッシュTTLを設定（一覧60秒・詳細300秒）
  - [ ] 6.6 保存/削除時のキャッシュパージを実装方針として定義（該当ページ＋一覧）
  - [ ] 6.7 Notion APIキー/データベースIDの管理ポリシーを定義（環境変数）

- [ ] 7.0 Cloud Functions: リアクション/コメントAPI設計
  - [ ] 7.1 いいねのトグルAPIを設計（`postStats.likesCount`の増減更新）
  - [ ] 7.2 ブックマークのトグルAPIを設計
  - [ ] 7.3 コメント作成APIを設計（親ID任意で無制限ネスト許可, 1000文字・改行可）
  - [ ] 7.4 コメント削除APIを設計（本人/管理者のみ, ソフト削除）
  - [ ] 7.5 コメント取得APIを設計（親20件/ページ, 返信は親ごとにページング/折りたたみ取得）
  - [ ] 7.6 管理者用コメント非表示/削除APIを設計（ロール確認）

- [ ] 8.0 Cloud Functions: 通知
  - [ ] 8.1 通知配信のトリガーを定義（コメント/返信/いいね）
  - [ ] 8.2 通知設定のオン/オフを反映（全体トグル, 既定ON）
  - [ ] 8.3 通知タップ時の遷移仕様を定義（詳細WebViewを開く）
  - [ ] 8.4 通知履歴保存方針を定義（マイページ表示用）

- [ ] 9.0 アプリUI: 一覧画面
  - [ ] 9.1 ページ番号式ページネーションを実装方針として定義（1ページ20件）
  - [ ] 9.2 並び順を新着順で固定（published_at desc）
  - [ ] 9.3 カードにタイトル/カバー（任意）/いいね数を表示する方針を定義
  - [ ] 9.4 検索/カテゴリ/タグ（OR）フィルタのUIを定義（ANDで組み合わせ）
  - [ ] 9.5 いいね/ブックマーク操作を一覧上で有効化する方針を定義
  - [ ] 9.6 ログインガードの動線を定義（未ログイン時の導線）

- [ ] 10.0 アプリUI: 詳細画面
  - [ ] 10.1 WebViewでCanvaスマート埋め込みURLを表示する方針を定義
  - [ ] 10.2 いいね/ブックマーク/コメントボタンの配置を定義（WebView周辺）
  - [ ] 10.3 コメントボトムシートのUI/開閉動作を定義
  - [ ] 10.4 埋め込みブロック時のフォールバックを定義（警告＋外部ブラウザで開くボタン）
  - [ ] 10.5 時刻表示のローカライズ方針を定義（保存UTC→表示ローカル）

- [ ] 11.0 アプリUI: 投稿作成画面
  - [ ] 11.1 入力項目を配置（タイトル/Canva埋め込みURL/カテゴリ/タグ/カバー画像任意）
  - [ ] 11.2 タグの選択数制限（1〜5）を検証（UI側バリデーション）
  - [ ] 11.3 タイトル最大60文字/サマリー160文字の制約を検証（必要に応じ入力欄）
  - [ ] 11.4 カバー画像のアップロード/16:9中央トリミングの方針を定義
  - [ ] 11.5 送信時にCloud Functionsへ連携（サーバーでpublished_at設定）

- [ ] 12.0 アプリUI: コメントパネル
  - [ ] 12.1 親コメントのページネーション（20件/ページ）を定義
  - [ ] 12.2 返信の折りたたみ/展開＋追加読み込みを定義
  - [ ] 12.3 並び順（古い順）を定義（親/子とも）
  - [ ] 12.4 ソフト削除表示を定義（本文「[削除済み]」）
  - [ ] 12.5 プロフィール名/アイコン表示（Firebaseプロフィール参照）を定義

- [ ] 13.0 アプリUI: マイページ
  - [ ] 13.1 自分の投稿一覧画面の要件を定義
  - [ ] 13.2 通知履歴一覧画面の要件を定義
  - [ ] 13.3 通知全体オン/オフ切替UIを定義（デフォルトON）

- [ ] 14.0 バリデーション/ガバナンス
  - [ ] 14.1 Canvaスマート埋め込みURLの検証ルールを定義（形式/ドメイン）
  - [ ] 14.2 画像形式/サイズ/アスペクト比の検証ルールを定義
  - [ ] 14.3 コメント文字数（1000）/改行許可の検証ルールを定義
  - [ ] 14.4 タグ選択数（1〜5）のサーバー検証ルールを定義
  - [ ] 14.5 スパム対策/レート制限は無しの運用方針を明記（将来拡張の注意）

- [ ] 15.0 権限/管理運用
  - [ ] 15.1 投稿の管理操作はNotionで実施の運用を明記（ソフト削除/非表示）
  - [ ] 15.2 コメントの管理UIをアプリ側に用意する運用を明記（ソフト削除/非表示）

- [ ] 16.0 監視/品質
  - [ ] 16.1 失敗時のユーザー向けエラーメッセージ方針を定義（埋め込み不可/権限/ネットワーク）
  - [ ] 16.2 キャッシュの整合性検証フローを定義（保存/削除後の即時反映確認）
  - [ ] 16.3 タイムゾーン/時刻表示の受け入れ基準を定義（UTC保存/ローカル表示の検証観点）
````