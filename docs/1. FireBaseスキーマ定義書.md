## Firestore スキーマ定義書 ##
# 1.0　記載すること
- •コレクションパス: ルートからのフルパスを記述します。
- •ドキュメントID: 自動IDか、特定のフィールド（userIdなど）を利用するかを明記します。
- •説明: コレクションが何のデータを格納するかを簡潔に説明します。
- •フィールド定義: 各フィールドについて、名前、型、必須かどうか、説明を記載します。
- •インデックス: クエリのパフォーマンスを向上させるために必要なインデックス（特に複合インデックス）を定義します。

# 1.1 comments
- 投稿に対するコメントを格納します。
- スレッド形式をサポートするため、parentIdとdepthフィールドを持ちます。
- •コレクションパス: posts/{postId}/comments
- •ドキュメントID: 自動生成ID
| フィールド名 | 型 | 必須 | 説明 | 
| :--- | :--- | :--- | :--- | 
| authorId | string | ✔️ | コメント投稿者のuserId。 | 
| text | string | ✔️ | コメント本文。バリデーション（例: 1000文字以内）をクライアントとセキュリティルールで適用します。 | 
| parentId | string | | 返信先のコメントID。親コメントの場合はnull。 |
| depth | number | ✔️ | コメントの階層の深さ。親コメントは0、その返信は1。 |
| isDeleted | boolean | ✔️ | ソフトデリート用のフラグ。trueの場合、「このコメントは削除されました」と表示します。初期値はfalse。 |
| createdAt | timestamp | ✔️ | 作成日時。 | 
| updatedAt | timestamp | ✔️ | 更新日時。 |

# インデックス:
- •createdAt (昇順): 親コメントを古い順に取得するために必要です。
- •parentId (昇順), createdAt (昇順): 特定の親コメントへの返信を古い順に取得するために必要です。

## 1.2 likes
- ユーザーがどの投稿に「いいね」したかを管理します。
- •コレクションパス: users/{userId}/likes
- •ドキュメントID: いいねした投稿のpostId
| フィールド名 | 型 | 必須 | 説明 | | :--- | :--- | :--- | :--- | 
| postId | string | ✔️ | いいねした投稿のID。ドキュメントIDと同じ値。 | 
| createdAt | timestamp| ✔️ | いいねした日時。 |

# インデックス:
- •このコレクションは主にドキュメントの存在確認（doc(postId).exists）に利用するため、複合インデックスは不要です。

## 1.3 bookmarks
- ユーザーがどの投稿をブックマークしたかを管理します。
- •コレクションパス: users/{userId}/bookmarks
- •ドキュメントID: ブックマークした投稿のpostId
| フィールド名 | 型 | 必須 | 説明 | 
| :--- | :--- | :--- | :--- |
| postId | string | ✔️ | ブックマークした投稿のID。ドキュメントIDと同じ値。 |
| createdAt | timestamp| ✔️ | ブックマークした日時。 |

# インデックス:
- •特定のユーザーのブックマーク一覧を新しい順に取得する場合に備え、インデックスを作成します。
- •createdAt (降順)

## 1.4 postStats投稿ごとの集計情報（いいね数、コメント数など）を管理します。非正規化データであり、読み取りパフォーマンスを向上させるために利用します。
- •コレクションパス: postStats
- •ドキュメントID: 対象のpostId
| フィールド名 | 型 | 必須 | 説明 |
| :--- | :- | :--- | :--- |
| likesCount | number | ✔️ | いいねの総数。likesコレクションへの書き込みと同時にトランザクションで更新します。初期値は0。 |
| commentsCount| number | ✔️ | コメントの総数（ソフトデリートされたものも含む）。commentsコレクションへの書き込みと同時にトランザクションで更新します。初期値は0。 |

# インデックス:
- •このコレクションはpostIdによる直接参照が主なため、複合インデックスは不要です。

## 1.5 notifications
- ユーザーへの通知（いいね、コメント、返信など）を格納します。
- •コレクションパス: users/{userId}/notifications
- •ドキュMントID: 自動生成ID
| フィールド名 | 型 | 必須 | 説明 |
| :--- | :--- | :--- | :--- |
| type | string | ✔️ | 通知の種類 ('like', 'comment', 'reply')。 |
| senderId | string | ✔️ | 通知のトリガーとなったアクションを実行したユーザーのID。 |
| postId | string | ✔️ | 関連する投稿のID。 |
| commentId | string | | 通知がコメントや返信に関連する場合のコメントID。 |
| isRead | boolean | ✔️ | ユーザーが通知を既読したかどうかのフラグ。初期値はfalse。 |
| createdAt | timestamp| ✔️ | 通知が作成された日時。 |

# インデックス:
- •未読の通知を一覧表示したり、時系列で表示したりするためにインデックスを作成します。
- •createdAt (降順)

## 1.6 userSettings
- ユーザーごとの設定情報を管理します。
- •コレクションパス: userSettings
- •ドキュメントID: 対象ユーザーのuserId
| フィールド名 | 型 | 必須 | 説明 |
| :--- | :--- | :--- | :--- |
| notificationsEnabled | boolean | ✔️ | プッシュ通知の受信を全体として許可するかどうか。初期値はtrue。 |
| updatedAt | timestamp| ✔️ | 設定が最後に更新された日時。 |

# インデックス:
- •このコレクションはuserIdによる直接参照が主なため、複合インデックスは不要です。